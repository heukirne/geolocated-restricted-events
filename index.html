<!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
<link rel="stylesheet" href="https://formden.com/static/cdn/bootstrap-iso.css" /> 

<!-- HTML Form (wrapped in a .bootstrap-iso div) -->
<div class="bootstrap-iso" style="margin-right: auto; margin-left: auto;">
 <div class="container-fluid">
  <div class="row">
   <div class="col-md-6 col-sm-6 col-xs-12">

   	<h2>Agendamento de Fotos</h2> </br>

    <form class="form-horizontal" id="calendar_send" method="post">

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="address">
       Endere&ccedil;o <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="address" name="address" type="text"/>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="date">
       Data <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="date" name="date" placeholder="MM/DD/YYYY" type="text"/>
     </div>

     <div class="form-group col-sm-10">
       <button class="btn btn-primary " name="submit" type="button" id="checkAvaiable">
        Verificar Disponibilidade
       </button>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label" for="horario">
       Selecione um hor&aacute;rio <span class="asteriskField">*</span>
      </label>
       <select class="select form-control" id="horario" name="horario">
        <option value="">
         Verifique a disponibilidade
        </option>
       </select>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="predio">
       Nome do Pr&eacute;dio <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="predio" name="predio" type="text"/>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="proprietario">
       Propriet&aacute;rio <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="proprietario" name="proprietario" type="text"/>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="corretor">
       Corretor <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="corretor" name="corretor" type="text"/>
     </div>

	<div class="form-group col-sm-10">
      <label class="control-label" for="metragem">
       Selecione a metragem <span class="asteriskField">*</span>
      </label>
      <div class="col-sm-10">
       <div class="radio-inline">
        <label class="radio">
         <input name="metragem" type="radio" value="300"/>
         at&eacute; 300m&sup2;
        </label>
       </div>
       <div class="radio-inline">
        <label class="radio">
         <input name="metragem" type="radio" value="500"/>
         at&eacute; 500m&sup2;
        </label>
       </div>
       <div class="radio-inline">
        <label class="radio">
         <input name="metragem" type="radio" value="1000"/>
         maior que 500m&sup2;
        </label>
       </div>
      </div>
     </div>

	<div class="form-group col-sm-10">
      <label class="control-label" for="infra">
       Selecione quantos ambiente tem na infraestrutura <span class="asteriskField">*</span>
      </label>
      <div class="col-sm-10">
       <div class="radio-inline">
        <label class="radio">
         <input name="infra" type="radio" value="0"/>
         sem infra
        </label>
       </div>
       <div class="radio-inline">
        <label class="radio">
         <input name="infra" type="radio" value="3"/>
         at&eacute; 3
        </label>
       </div>
       <div class="radio-inline">
        <label class="radio">
         <input name="infra" type="radio" value="5"/>
         at&eacute; 5
        </label>
       </div>
       <div class="radio-inline">
        <label class="radio">
         <input name="infra" type="radio" value="10"/>
         mais que 5
        </label>
       </div>
      </div>
     </div>

     <div class="form-group col-sm-10">
      <label class="control-label requiredField" for="email">
       Email <span class="asteriskField">*</span>
      </label>
       <input class="form-control" id="email" name="email" type="text"/>
     </div>

     <div class="form-group col-sm-10">
       <button class="btn btn-primary " name="submit" type="submit">
        Enviar Agendamento
       </button>
     </div>

    </form>
   </div>
  </div>
 </div>
</div>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=&libraries=places"></script>
<!-- Extra JavaScript/CSS added manually in "Settings" tab -->
<!-- Include jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Include Date Range Picker -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>

<script>
	function isEmail(email) {
	  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	  return regex.test(email);
	}

	$(document).ready(function(){
		var date_input=$('input[name="date"]'); //our date input has the name "date"
		var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
		date_input.datepicker({
			format: 'dd/mm/yyyy',
			container: container,
			todayHighlight: true,
			autoclose: true,
		})

		var defaultBounds = new google.maps.LatLngBounds(
			new google.maps.LatLng(-29.967808, -51.242466),
			new google.maps.LatLng(-30.157086, -51.013126));

		var options = {
		  bounds: defaultBounds,
		  types: ['address'],
		  componentRestrictions: {country: 'br'}
		};

        var autocomplete = new google.maps.places.Autocomplete($("#address")[0], options);

        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var place = autocomplete.getPlace();
            console.log(place.address_components);

            place.address_components.forEach(function(item){
            	if (item.types[0].indexOf("postal") == 0) {
            		$("#address").val($("#address").val() + ", " + item.short_name)
            	}
            })

        });

		$('#calendar_send').submit(function(){
			var isValid = true;

			if ($('[name=infra]:checked').length == 0) { isValid = false; }
			if ($('[name=metragem]:checked').length == 0) { isValid = false; }

			$("input").each(function() {
			   var element = $(this);
			   if (element.val() == "") {
			       isValid = false;
			   }
			});

			if ( isValid ) {
				return true;
			} else {
				alert('Todos os campos sao obrigatorios.');
				return false;
			}
		});

		$('#checkAvaiable').click(function(){
			if ($('#address').val() == "" && $('#date').val() == "" ) {
				alert('Preencha o endereco e a data!');
				return false;
			}

			$.getJSON( "check_avaiable.php", {
          address: $('#address').val(),
          date: $('#date').val()
      })
      .done( function( data ) {

				console.log(data);

			    $('#horario').empty();
			    $.each(data, function(i, obj){
			            $('#horario').append($('<option>').text(obj.val).attr('value', obj.key));
			    });
			});

		});

	})
</script>
